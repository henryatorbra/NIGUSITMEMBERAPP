<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, width=device-width" />

    <link rel="stylesheet" href="./global.css" />
    <link rel="stylesheet" href="./affiliated-businesses.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Archivo Black:wght@400&display=swap"
    />
  </head>
  <body id="body">
    <div class="affiliated-businesses1">
      <header class="rectangle-parent11">
        <div class="frame-child29"></div>
        <div class="frame-wrapper4">
          <img
            class="frame-child30"
            loading="lazy"
            alt=""
            src="C:\Users\uswe\OneDrive\Desktop\WEB APP\Affiliated Business Page\Resources\icons8-arrow-left-50 (1).png"
            id="groupIcon"
          />
        </div>
        <div class="businesses">BUSINESSES</div>
      </header>
      <img
        class="affiliated-businesses-child"
        alt=""
        src="C:\Users\uswe\OneDrive\Desktop\WEB APP\Affiliated Business Page\Resources\Ellipse 35.png"
      />

      <section class="affiliated-businesses-inner">
        <div class="frame-parent14" id="main">
        
          <div class="rectangle-parent13" onclick="navigateToBusinessPage('./eats-deli-page.html');">
            <div class="frame-child34" id="rectangle2"></div>
            <div class="ellipse-parent5">
              <img
                class="frame-child35"
                alt=""
                src="C:\Users\uswe\OneDrive\Desktop\WEB APP\Affiliated Business Page\Resources\Ellipse 30.png"
              />
              <div class="eats-deli-wrapper">
                <b class="eats-deli">Eats Deli</b>
              </div>
            </div>
            <div class="frame-wrapper6">
              <img
                class="frame-child36"
                alt=""
                src="C:\Users\uswe\OneDrive\Desktop\WEB APP\Affiliated Business Page\Resources\Vector.png"
              />
            </div>
          </div>
          <div class="rectangle-parent14" onclick="navigateToBusinessPage('./sweets-treats-page.html');">
            <div class="frame-child37" id="rectangle3"></div>
            <div class="ellipse-parent6">
              <img
                class="frame-child38"
                loading="lazy"
                alt=""
                src="C:\Users\uswe\OneDrive\Desktop\WEB APP\Affiliated Business Page\Resources\Ellipse 38.png"
              />
              <div class="sweets-treats-wrapper">
                <b class="sweets-treats">Sweets & Treats</b>
              </div>
            </div>
            <div class="frame-wrapper7">
              <img
                class="frame-child39"
                loading="lazy"
                alt=""
                src="C:\Users\uswe\OneDrive\Desktop\WEB APP\Affiliated Business Page\Resources\Vector.png"
              />
            </div>
          </div>
          <button class="rectangle-parent15" onclick="navigateToBusinessPage('./spice-bistro-page.html');">
            <div class="frame-child40" id="rectangle4"></div>
            <div class="ellipse-parent7">
              <img
                class="frame-child41"
                alt=""
                src="C:\Users\uswe\OneDrive\Desktop\WEB APP\Affiliated Business Page\Resources\Ellipse 37.png"
              />
              <div class="spice-bistro-wrapper">
                <b class="spice-bistro">Spice Bistro</b>
              </div>
            </div>
            <div class="frame-wrapper8">
              <img
                class="frame-child42"
                alt=""
                src="C:\Users\uswe\OneDrive\Desktop\WEB APP\Affiliated Business Page\Resources\Vector.png"
              />
            </div>
          </button>
          <div class="rectangle-parent16" onclick="navigateToBusinessPage('./happy-grills-page.html');">
            <div class="frame-child43" id="rectangle5"></div>
            <div class="ellipse-parent8">
              <img
                class="frame-child44"
                alt=""
                src="C:\Users\uswe\OneDrive\Desktop\WEB APP\Affiliated Business Page\Resources\Ellipse 33.png"
              />
              <div class="happy-grills-wrapper">
                <b class="happy-grills">Happy Grills</b>
              </div>
            </div>
            <div class="frame-wrapper9">
              <img
                class="frame-child45"
                alt=""
                src="C:\Users\uswe\OneDrive\Desktop\WEB APP\Affiliated Business Page\Resources\Vector.png"
              />
            </div>
          </div>
          <button class="rectangle-parent17" onclick="navigateToBusinessPage('./noodle-bar-page.html');">
            <div class="frame-child46" id="rectangle6"></div>
            <div class="ellipse-parent9">
              <img
                class="frame-child47"
                alt=""
                src="C:\Users\uswe\OneDrive\Desktop\WEB APP\Affiliated Business Page\Resources\Ellipse 36.png"
              />
              <div class="noodle-bar-wrapper">
                <b class="noodle-bar">Noodle Bar</b>
              </div>
            </div>
            <div class="frame-wrapper10">
              <img
                class="frame-child48"
                alt=""
                src="C:\Users\uswe\OneDrive\Desktop\WEB APP\Affiliated Business Page\Resources\Vector.png"
              />
            </div>
          </button>
        </div>
      </section>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', loadbusinesses, false)
      function navigateToBusinessPage(url) {
        window.location.href = url;
      }

      var groupIcon = document.getElementById("groupIcon");
      if (groupIcon) {
        groupIcon.addEventListener("click", function (e) {
          window.location.href = "./profile.html";
        });
      }

      // this function will be attached to an onload event listener.
      async function loadbusinesses (){
        // step one, make api request to get businesses.

        console.log("onload fired well");

        var response =  await fetch('https://nigusitmemberapp.onrender.com/getaffiliatedbusinesses', {
            method: 'GET',  
          });

          var data = await response.text();
          var intermediateData = JSON.parse(data)

          switch (response.status) {
            case 401:
              alert('Invalid credentials');
              break;
            case 200:
              alert('fetched businessses Successfully');
              //window.location.href = "https://nigusitmemberapp.onrender.com/profilepage";
               break;
            case 400:
              alert('Not authorized');
              break;
            
          }

        console.log(`affliated businesses GET request result ${JSON.stringify(intermediateData[0])}`);
      //  create the element you want  <b class="noodle-bar">Noodle Bar</b>
          if (intermediateData.length == 0){
            return;
          }
      intermediateData.map((e, i)=>{
        console.log("map works");
        var bElement = document.createElement('div');
         bElement.className = "noodle-bar";
         bElement.innerHTML = `<button class="rectangle-parent17" onclick="navigateToBusinessPage('./noodle-bar-page.html');">
            <div class="frame-child46" id="rectangle6"></div>
            <div class="ellipse-parent9">
              <img
                class="frame-child47"
                alt=""
                src="\Affiliated Business Page\Resources\Ellipse 36.png"
              />
              <div class="noodle-bar-wrapper">
                <b class="noodle-bar">${e.businessname}</b>
              </div>
            </div>
            <div class="frame-wrapper10">
              <img
                class="frame-child48"
                alt=""
                src="Affiliated Business Page\Resources\Vector.png"
              />
            </div>
          </button>`
        // select the element you want from The DOM
         var oldElement = document.getElementById('main');
        //  .getElementsByTagName("ul")[0];

         // append the new element to the old element.
         oldElement.appendChild(bElement);
      })


      }
    </script>
  </body>
</html>
